{% extends "admin/base.html" %}

{% block title %}User Management{% endblock %}

{% block content %}
<div class="page-header">
  <h1>ğŸ‘¥ User Management</h1>
  <p>Manage and monitor registered users</p>
</div>

<!-- Search Box -->
<div class="search-box">
  <form method="GET" action="{{ url_for('admin_users') }}" style="display: flex; gap: 0.5rem; width: 100%;">
    <input 
      type="text" 
      name="search" 
      class="search-input" 
      placeholder="Search by username or email..." 
      value="{{ search }}"
    >
    <button type="submit" class="btn btn-primary">
      <i class="fas fa-search"></i> Search
    </button>
    {% if search %}
      <a href="{{ url_for('admin_users') }}" class="btn btn-secondary">
        <i class="fas fa-times"></i> Clear
      </a>
    {% endif %}
  </form>
</div>

<!-- Users Table -->
<div class="card">
  <div class="card-header">
    <h2><i class="fas fa-users"></i> Users ({{ users.total }})</h2>
  </div>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Email</th>
          <th>Account Type</th>
          <th>Registered</th>
          <th>Last Login</th>
          <th>Resumes</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users.items %}
          <tr>
            <td style="color: var(--text-muted); font-size: 0.85rem;">{{ user.id }}</td>
            <td>
              <a href="{{ url_for('admin_user_detail', user_id=user.id) }}" style="color: var(--accent); text-decoration: none; font-weight: 500;">
                {{ user.username }}
              </a>
            </td>
            <td style="color: var(--text-muted); font-size: 0.85rem;">{{ user.email }}</td>
            <td>
              {% if user.account_type == 'premium' %}
                <span class="badge badge-warning">Premium</span>
              {% elif user.account_type == 'enterprise' %}
                <span class="badge badge-info">Enterprise</span>
              {% else %}
                <span class="badge" style="background: rgba(255, 255, 255, 0.1); color: var(--text-muted);">Free</span>
              {% endif %}
            </td>
            <td style="color: var(--text-muted); font-size: 0.85rem;">
              {{ user.created_at.strftime('%Y-%m-%d') if user.created_at else 'N/A' }}
            </td>
            <td style="color: var(--text-muted); font-size: 0.85rem;">
              {{ user.last_login.strftime('%Y-%m-%d %H:%M') if user.last_login else 'Never' }}
            </td>
            <td style="text-align: center;">
              <span class="badge badge-info">{{ user.resume_history.count() }}</span>
            </td>
            <td>
              <div style="display: flex; gap: 0.5rem;">
                <a href="{{ url_for('admin_user_detail', user_id=user.id) }}" class="btn btn-secondary" style="padding: 0.5rem 0.75rem;">
                  <i class="fas fa-eye"></i>
                </a>
                <form method="POST" action="{{ url_for('admin_delete_user', user_id=user.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete user {{ user.username }}? This will delete all their data.');">
                  <button type="submit" class="btn btn-danger" style="padding: 0.5rem 0.75rem;">
                    <i class="fas fa-trash"></i>
                  </button>
                </form>
              </div>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="8" style="text-align: center; padding: 2rem; color: var(--text-muted);">
              {% if search %}
                No users found matching "{{ search }}"
              {% else %}
                No users registered yet
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if users.pages > 1 %}
    <div class="pagination">
      {% if users.has_prev %}
        <a href="{{ url_for('admin_users', page=users.prev_num, search=search) }}">
          <i class="fas fa-chevron-left"></i>
        </a>
      {% endif %}

      {% for page_num in users.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if page_num %}
          {% if page_num == users.page %}
            <span class="active">{{ page_num }}</span>
          {% else %}
            <a href="{{ url_for('admin_users', page=page_num, search=search) }}">{{ page_num }}</a>
          {% endif %}
        {% else %}
          <span>...</span>
        {% endif %}
      {% endfor %}

      {% if users.has_next %}
        <a href="{{ url_for('admin_users', page=users.next_num, search=search) }}">
          <i class="fas fa-chevron-right"></i>
        </a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}
